import{d as K,r as o,X as A,a8 as Q,O as l,R as c,P as W,a4 as Z,a3 as p,Y as F,a2 as B,$ as R,a9 as ee,o as d,U as P,V as T}from"./vendor.aad8767c.js";import{P as te,g as ae}from"./AccountApi.5c83433a.js";import{h as se}from"./axios.e8a5cbbb.js";import{_ as ne}from"./plugin-vue_export-helper.21dcd24c.js";const re="/messageFormat",oe=re+"/getMessageFormats";function ie(){return se.get(oe)}const ue={class:"action"},ce={class:"context"},le={class:"context"},pe=K({setup(de){const V=ee(),u=o(0),v=A([]),g=A([]),h=o(0),D=o(0),f=o(""),M=o(""),_=o(0),x=o(0),z=o(null),L=o(null),O={title:{text:"\u672C\u6708\u6536\u652F"},tooltip:{trigger:"item"},xAxis:{type:"category",data:[1e3]},yAxis:{type:"value",min:function(){return 0},max:function(){return 1e4},axisLabel:{rotate:45}},series:[{name:"spend",type:"bar",data:[2e3]}]},S={tooltip:{trigger:"item"},series:[{name:"type",type:"pie",radius:"50%",data:[{value:1048,name:"Search Engine"},{value:735,name:"Direct"},{value:580,name:"Email"},{value:484,name:"Union Ads"},{value:300,name:"Video Ads"}]}]},$=()=>{let t=new Map,e=new Date(m,y+1,0).getDate();for(let n=1;n<=e;n++)t.set(n,0),i.forEach(I=>{let H=new Date(I.time).getDate();if(n==H){let J=t.get(n);I.isOut===u.value&&t.set(n,J+Number(I.money))}});let a=[...t.entries()],r=a.map(n=>n[0]),s=a.map(n=>n[1]);O.xAxis.data=r,O.series[0].data=s,G()},k=()=>{let t=new Map;i.forEach(a=>{if(a.isOut==u.value)if(t.has(a.type)){let r=t.get(a.type);t.set(a.type,r+1)}else t.set(a.type,1)});let e=[];for(const[a,r]of t){let s={value:0,name:""};s.value=r,s.name=a,e.push(s)}S.series[0].data=e,U()},E=V.appContext.config.globalProperties.echarts,G=()=>{E.init(document.getElementById("bar")).setOption(O)},U=()=>{E.init(document.getElementById("pie")).setOption(S)};async function Y(){v.splice(0,v.length),g.splice(0,g.length);const t=await ie();t.messageCode=="ok"&&t.data.messageFormats.forEach(e=>{e.parentid==1?(e.description=e.description.replace("maxIn",h.value==-1/0?0:h.value),e.description=e.description.replace("maxOut",D.value==-1/0?0:D.value),e.description=e.description.replace("avgIn",isNaN(Number(f.value))?"0":f.value),e.description=e.description.replace("avgOut",isNaN(Number(f.value))?"0":M.value),v.push(e)):(e.description=e.description.replace("typeIn",_.value?_.value:0),e.description=e.description.replace("typeOut",x.value?x.value:0),g.push(e))})}const j=()=>{const t=i.map(s=>s.isOut==1?s.money:0),e=i.map(s=>{if(s.isOut==1)return s.type}).filter(s=>s!=null);_.value=new Set(e).size,h.value=Math.max(...t),f.value=(t.reduce((s,n)=>s+n,0)/t.length).toFixed(2);const a=i.map(s=>s.isOut==0?s.money:0),r=i.map(s=>{if(s.isOut==0)return s.type}).filter(s=>s!=null);x.value=new Set(r).size,D.value=Math.max(...a),M.value=(a.reduce((s,n)=>s+n,0)/a.length).toFixed(2),Y()},i=A([]),b=o(new Date),m=b.value.getFullYear(),y=b.value.getMonth(),C=o(""),w=o("");async function N(){let t=localStorage.getItem("uid");const e=await ae({startTime:C.value,endTime:w.value,uid:t});e.messageCode=="ok"&&(i.splice(0,i.length),e.data.accounts.forEach(r=>{i.push(r)}),k(),$(),j())}const q=(t,e)=>{let a=new Date(t,e,0).getDate();C.value=`${t}-${e}-${1}`,w.value=`${t}-${e}-${a}`,N()};Q(()=>{let t=new Date(m,y+1,0).getDate();C.value=`${m}-${y+1}-${1}`,w.value=`${m}-${y+1}-${t}`,N()});const X=()=>{u.value=u.value==0?1:0,$(),k()};return(t,e)=>(d(),l(F,null,[c("div",ue,[W(te,{onGetDate:q,currentDate:b.value},null,8,["currentDate"]),c("span",{class:Z(["count-isOut",u.value==0?"out":"in"]),onClick:X},p(u.value==0?"\u652F\u51FA":"\u6536\u5165"),3)]),c("div",{id:"bar",ref_key:"barRef",ref:z},null,512),c("div",ce,[(d(!0),l(F,null,B(R(v),(a,r)=>P((d(),l("div",{class:"message-item",key:r},p(a.title)+" : "+p(a.description)+" \u5143 ",1)),[[T,a.isShow==1]])),128))]),c("div",{id:"pie",ref_key:"pieRef",ref:L},null,512),c("div",le,[(d(!0),l(F,null,B(R(g),(a,r)=>P((d(),l("div",{class:"message-item",key:r},p(a.title)+" : "+p(a.description)+" \u79CD ",1)),[[T,a.isShow==1]])),128))])],64))}});var ye=ne(pe,[["__scopeId","data-v-677f217b"]]);export{ye as default};
